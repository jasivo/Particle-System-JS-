<html>
    
    <head>
        <title> Pawe≈Ç Jurkiw - Particle System</title>
    </head>
    <style>
        body {margin: 0;}
        canvas {width: 100%; height:100%};
    </style>
    
    <body>
        <script src="js/three.js"></script>
        <!-- <script src="js/p5.js"></script> -->

        <script>

            const radius = 10;
            const segments = 15;
            const rings = 15;
            var time;
            var dt;

            // Czasteczka
            class Particle
            {
                constructor(x,y,z)
                {
                    this.geometry = new THREE.SphereGeometry(radius, segments, rings);
                    this.material = new THREE.MeshStandardMaterial({
                        color: 0xffffff,});
                    this.mesh = new THREE.Mesh(this.geometry, this.material);
                    this.mesh.position.set(x,y,z);
                    this.lifetime = 255;
                    this.velocity = new THREE.Vector3(THREE.MathUtils.randFloat(-1, 1), THREE.MathUtils.randFloat(-0.75, -0.5), THREE.MathUtils.randFloat(-1,1));
                    this.acceleration = new THREE.Vector3(0,9.81,0);
                }

                addPosition(x,y,z)
                {
                    this.mesh.position.x += x;
                    this.mesh.position.y += y;
                    this.mesh.position.z += z;
                }

                rotation(x,y,z)
                {
                    this.mesh.rotation.x += x;
                    this.mesh.rotation.y += y;
                    this.mesh.rotation.z += z;
                }

                update()
                {
                    dt = (Date.now() - time) * 0.1;
                    time = Date.now();
                    //let da = this.acceleration;
                    this.velocity.add(this.acceleration.clone().multiplyScalar(dt));
                    this.mesh.position.add(this.velocity);
                    this.rotation(.02,.02,.02);
                    this.lifetime -= 1;
                }

                display()
                {
                    scene.add(this.mesh);
                }
             
                isDead()
                {
                    return this.lifetime <= 0;
                }

                run()
                {
                    this.update();
                    this.display();
                }
            }

            class Emiter
            {
                constructor(position)
                {
                    this.x = position.x;
                    this.y = position.y;
                    this.z = position.z;
                    //this.origin = position.copy();
                    this.particles = [];
                }

                addParticle()
                {
                    //let p = new Particle(this.x,this.y,this.z);
                    this.particles.push(new Particle(this.x,this.y,this.z));
                    //this.particles.push(p);
                    //scene.add(p.mesh);
                }

                run()
                {
                    //scene = new THREE.Scene();
                    for(let i = 0; i < this.particles.length; i++)
                    {
                        let particle = this.particles[i];
                        particle.run();
                        //particle.display()
                        if(particle.isDead())
                        {
                            this.particles.splice(i,1);
                        }
                    }

                }
            }

            function drawSphere() {
                init();
                animate();
            }

            function init() {
                // Kamera

                scene = new THREE.Scene()
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / innerHeight, 0.1, 1000);
                camera.position.z = 200;
                
                var light = new THREE.PointLight(0xffffff, 1, Infinity);
                camera.add(light);
                scene.add(camera);

                // Scena

                //scene.add(particle.mesh);

                // Renderer
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                time = Date.now();

            }

            //var particle = new Particle(0,0,0);
            var emiter = new Emiter(new THREE.Vector3(0,0,0));

            function animate() {
                requestAnimationFrame(animate);
                render();
            }

            function render() {
                //particle.rotation(.03,.03,.03)
                //particle.addPosition(.2,.2,0);
                emiter.addParticle();
                emiter.run();
                renderer.render(scene, camera);
            }

            // fn callin
            drawSphere();

        </script>
    </body>

</html>